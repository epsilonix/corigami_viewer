<!-- plots_partial.html -->
<div id="plots-container" style="width: 100%; overflow-x: auto;">

  <div id="hi_c_chart"></div>
  <div id="custom_axis_hic"></div>

  <div class="atac_title_container">
    <div class="atac_title">
      <span class="atac-square"></span>
      ATAC signal
    </div>
  </div>
  <div id="atac_chart"></div>
  <div id="custom_axis_atac"></div>
  
  <div class="ctcf_title_container">
    <div class="ctcf_title">
      <span class="ctcf-square"></span>
      CTCF signal
    </div>
  </div>
  <div id="ctcf_chart"></div>
  <div id="custom_axis_ctcf"></div>

  {% if screening_mode %}
    <div class="screening_title_container">
      <div class="screening_title">
        <span class="screening-square"></span>Impact score
      </div>
    </div>
    <div id="screening_chart"></div>
    <div id="custom_axis_screening"></div>
  {% endif %}

  <div id="gene-track-wrapper" style="overflow-y: hidden;"> 
    <div id="gene_track_chart"></div>
  </div>

</div>

<script>
  /* 
   * Use the 'tojson' filter so Python None => JS null,
   * and any dict => valid JSON string. 
   * 'screening_mode' is a boolean, so we can handle that with an if/else or
   * just pass it as is. 
   */
  var hiCConfig        = {{ hi_c_config|tojson }};
  var ctcfConfig       = {{ ctcf_config|tojson }};
  var atacConfig       = {{ atac_config|tojson }};
  var geneTrackConfig  = {{ gene_track_config|tojson }};
  var customAxisConfig = {{ custom_axis_config|tojson }};

  // If the Python code sets screening_mode=True, we'll get JS "true", else "false".
  var screeningMode = {{ 'true' if screening_mode else 'false' }};

  // screening_config might be None => becomes null in JS
  var screeningConfig = {{ screening_config|tojson }};

  // Expose globally if needed outside this script
  window.screening_mode = screeningMode;

  // 1) Draw standard charts if they exist
  if (hiCConfig) {
    drawHiCChart('#hi_c_chart', hiCConfig);
    drawCustomAxis('#custom_axis_hic', customAxisConfig);
  }
  if (ctcfConfig) {
    drawColumnChart('#ctcf_chart', ctcfConfig);
    drawCustomAxis('#custom_axis_ctcf', customAxisConfig);
  }
  if (atacConfig) {
    drawColumnChart('#atac_chart', atacConfig);
    drawCustomAxis('#custom_axis_atac', customAxisConfig);
  }
  if (geneTrackConfig) {
    drawGeneTrackChart('#gene_track_chart', geneTrackConfig);
  }

  // 2) If screening_mode == true, either use the config or call runScreening()
  if (screeningMode) {
    if (screeningConfig) {
      // One-step approach: server gave us screening config
      drawColumnChart('#screening_chart', screeningConfig);
      drawCustomAxis('#custom_axis_screening', customAxisConfig);
    } else {
      // Two-step approach: run /run_screening endpoint now
      runScreening();
    }
  } else {
    console.log("No screening mode active.");
  }
</script>
